#!/usr/bin/env python3
import subprocess
import sys
import os
import rospkg

def main():
    """
    Skrip ini menerima satu argumen (path lengkap untuk menyimpan peta)
    dan membukanya di terminal baru.
    """
    if len(sys.argv) < 2:
        print("Error: Argumen path file peta tidak diberikan.")
        return

    map_save_path = sys.argv[1]
    
    # Perintah untuk menjalankan map_saver
    command = f"rosrun map_server map_saver -f {map_save_path}"
    
    # Perintah untuk membuka terminal baru (gnome-terminal) dan menjalankan perintah di dalamnya
    # Opsi '--' memastikan sisa argumen diperlakukan sebagai perintah untuk dieksekusi
    # Opsi 'bash -c "..."' memastikan perintah berjalan dan terminal tetap terbuka hingga selesai
    full_terminal_command = f'gnome-terminal -- bash -c "{command}; echo \\"Proses selesai. Anda bisa menutup terminal ini.\\"; exec bash"'

    try:
        print(f"Membuka terminal baru untuk menjalankan: {command}")
        # Jalankan perintah untuk membuka terminal baru
        subprocess.Popen(full_terminal_command, shell=True)
    except Exception as e:
        print(f"Gagal membuka terminal baru: {e}")

if __name__ == '__main__':
    main()
